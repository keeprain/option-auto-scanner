name: Auto Option Scanner

on:
  schedule:
    # è¥¿é›…å›¾æ—¶é—´æ—©ä¸Š 6:30 åˆ° ä¸‹åˆ 1:00 (å¯¹åº” UTC 13:30 - 20:00)
    # æ¯ 20 åˆ†é’Ÿè¿è¡Œä¸€æ¬¡
    - cron: '*/20 13-21 * * 1-5'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®æµ‹è¯•

jobs:
  build:
    runs-on: ubuntu-latest

    # ğŸ”¥ [æ–°å¢] å¿…é¡»åŠ è¿™å‡ è¡Œï¼Œå¦åˆ™ git push ä¼šæŠ¥é”™
    permissions:
      contents: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt

      - name: Run Scanner
        env:
          # è¿™é‡ŒæŠŠ Secrets ä¼ ç»™ Python
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          EMAIL_USER: ${{ secrets.EMAIL_USER }}
          EMAIL_PASS: ${{ secrets.EMAIL_PASS }}
          TO_EMAIL: ${{ secrets.TO_EMAIL }}
        run: python main.py

        # ğŸ”¥ æ–°å¢æ­¥éª¤ï¼šæŠŠç”Ÿæˆçš„ CSV æäº¤å›ä»“åº“
      - name: Commit and Push Data
        run: |
          # é…ç½® git ç”¨æˆ·èº«ä»½
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
          
          # å°è¯•æ·»åŠ  CSV æ–‡ä»¶
          git add option_history.csv
          
          # å¦‚æœæ²¡æœ‰å˜åŒ–ï¼ˆæ¯”å¦‚å‘¨æœ«æ²¡æ•°æ®ï¼‰ï¼Œå°±ä¸æŠ¥é”™
          git commit -m "ğŸ“ˆ Auto-update option history [skip ci]" || exit 0
          
          # æ¨é€åˆ°ä»“åº“
          git push
